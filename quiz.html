<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QR Safety Quiz</title>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg:#120205;
      --card:rgba(135,7,28,0.12);
      --card2:rgba(135,7,28,0.18);
      --border:rgba(135,7,28,0.35);
      --text:#fcecee;
      --muted:rgba(252,236,238,0.82);
      --title:#ff4d6d;
      --title2:#ff8fa3;
      --accent:#87071c;
      --accent2:#a50922;
    }

    *{box-sizing:border-box}

    html{
      min-height:100%;
      background:
        radial-gradient(1200px 500px at 20% 0%, rgba(135,7,28,0.35), transparent 60%),
        radial-gradient(900px 500px at 100% 20%, rgba(135,7,28,0.22), transparent 55%),
        var(--bg);
      background-attachment: fixed;
    }

    body{
      margin:0;
      min-height:100%;
      font-family:system-ui,-apple-system,sans-serif;
      color:var(--text);
      background:transparent;
    }

    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:44px 20px 70px;
      min-height:100vh;
    }

    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:12px;
    }

    h1{
      margin:0;
      color:var(--title);
      font-size:clamp(1.7rem,3vw,2.3rem);
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:22px;
      margin-top:18px;
      backdrop-filter:blur(6px);
    }

    /* ===== START QUIZ + BUNNY ===== */
    .start-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:18px;
      flex-wrap:wrap;
    }

    .start-left{
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }

    input{
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(255,255,255,0.05);
      color:var(--text);
      min-width:220px;
      outline:none;
    }

    .btn{
      background:var(--accent);
      color:#fff;
      padding:12px 18px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.12);
      font-weight:800;
      cursor:pointer;
    }
    .btn:hover{background:var(--accent2)}

    .btn-ghost{
      padding:12px 18px;
      border-radius:12px;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.14);
      color:var(--text);
      font-weight:800;
      text-decoration:none;
    }

    .quiz-bunny{
      width:150px;
      height:auto;
      filter:drop-shadow(0 0 20px rgba(135,7,28,0.6));
      pointer-events:none;
    }

    @media (max-width:640px){
      .start-row{
        flex-direction:column;
        align-items:flex-start;
      }
      .quiz-bunny{
        align-self:center;
        width:150px;
        margin-top:10px;
      }
    }

    /* ===== QUIZ ===== */
    .q{
      background:var(--card2);
      border:1px solid rgba(135,7,28,0.45);
      border-radius:16px;
      padding:16px;
      margin-top:14px;
    }

    .q h2{
      margin:0 0 10px;
      color:var(--title2);
      font-size:1.1rem;
    }

    .opt{
      width:100%;
      text-align:left;
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(255,255,255,0.05);
      color:var(--text);
      cursor:pointer;
      margin:8px 0;
      font-weight:650;
    }

    .opt:hover{
      background:rgba(135,7,28,0.22);
      transform:translateY(-1px);
    }

    .picked{
      border-color:rgba(56,189,248,.95)!important;
      background:rgba(56,189,248,.12)!important;
      box-shadow:0 0 0 2px rgba(56,189,248,.35);
    }

    .ok{
      border-color:rgba(34,197,94,.8)!important;
      background:rgba(34,197,94,.12)!important;
    }

    .bad{
      border-color:rgba(239,68,68,.8)!important;
      background:rgba(239,68,68,.12)!important;
    }

    .muted{color:var(--muted);font-size:.95rem}

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
    }

    th,td{
      padding:10px 8px;
      border-bottom:1px solid rgba(255,255,255,0.08);
    }

    th{color:var(--title2)}
  </style>
</head>

<body>
<div class="wrap">

  <div class="top">
    <h1>QR & Link Safety Quiz</h1>
    <a class="btn-ghost" href="index.html">← Back</a>
  </div>

  <!-- START QUIZ CARD -->
  <div class="card">
    <div class="start-row">
      <div class="start-left">
        <label class="muted"><b>Enter a nickname:</b></label>
        <input id="name" maxlength="18" placeholder="e.g. Obeidat">
        <button class="btn" id="startBtn">Start quiz</button>
      </div>

      <img src="bunny.png" class="quiz-bunny" alt="Knight Bunny">
    </div>
  </div>

  <!-- QUIZ -->
  <div class="card" id="quizCard" style="display:none;">
    <div class="muted">
      <span id="playerLabel"></span> • Score: <b id="score">—</b>/<span id="total">0</span>
    </div>

    <div id="questions"></div>

    <button class="btn" id="finishBtn" style="margin-top:14px;">Finish & Save Score</button>
    <p id="msg" class="muted"></p>
  </div>

  <!-- SCOREBOARD -->
  <div class="card">
    <h2>Shared scoreboard</h2>
    <p class="muted">Top 50 scores.</p>
    <div id="board"></div>
  </div>

</div>

<script>
(() => {
  const SUPABASE_URL = "https://fagdpkcckpyhmmgmaqik.supabase.co";
  const SUPABASE_KEY = "sb_publishable_w3_sZUpV1LsChEuJGVWRnw_NLk17WPs";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const QUIZ = [
    {q:"Safest first step after scanning an unknown QR?",o:["Open it","Preview the URL","Share it","Disable Wi-Fi"],c:1},
    {q:"Biggest red flag link?",o:["portal.edu","uni.edu","bit.ly/verify","library.edu"],c:2},
    {q:"QR asks to install an app?",o:["Install","Close it","Install if logo","Restart then install"],c:1},
    {q:"HTTPS means…",o:["Trusted","Encrypted only","University-owned","Virus-free"],c:1}
  ];

  const nameEl = document.getElementById("name");
  const startBtn = document.getElementById("startBtn");
  const quizCard = document.getElementById("quizCard");
  const questionsEl = document.getElementById("questions");
  const scoreEl = document.getElementById("score");
  const totalEl = document.getElementById("total");
  const playerLabel = document.getElementById("playerLabel");
  const boardEl = document.getElementById("board");
  const finishBtn = document.getElementById("finishBtn");
  const msg = document.getElementById("msg");

  totalEl.textContent = QUIZ.length;
  let answers = Array(QUIZ.length).fill(null);

  function render(){
    questionsEl.innerHTML="";
    QUIZ.forEach((q,i)=>{
      const d=document.createElement("div");
      d.className="q";
      d.innerHTML=`<h2>Q${i+1}. ${q.q}</h2>`;
      q.o.forEach((t,j)=>{
        const b=document.createElement("button");
        b.className="opt";
        b.textContent=t;
        b.onclick=()=>{
          answers[i]=j;
          d.querySelectorAll(".opt").forEach(x=>x.classList.remove("picked"));
          b.classList.add("picked");
        };
        d.appendChild(b);
      });
      questionsEl.appendChild(d);
    });
  }

  startBtn.onclick=()=>{
    if(!nameEl.value.trim()) return alert("Enter a nickname");
    quizCard.style.display="block";
    playerLabel.textContent="Player: "+nameEl.value.trim();
    scoreEl.textContent="—";
    answers.fill(null);
    render();
  };

  finishBtn.onclick=async()=>{
    if(answers.some(a=>a===null)) return alert("Answer all questions");
    let score=answers.filter((a,i)=>a===QUIZ[i].c).length;
    scoreEl.textContent=score;

    await supabase.from("scores").insert([{name:nameEl.value,score,total:QUIZ.length}]);
    loadBoard();
    msg.textContent=`Saved! You scored ${score}/${QUIZ.length}`;
  };

  async function loadBoard(){
    const {data}=await supabase.from("scores")
      .select("*").order("score",{ascending:false}).limit(50);

    if(!data||!data.length){
      boardEl.innerHTML="<p class='muted'>No scores yet.</p>";
      return;
    }

    boardEl.innerHTML="<table><tr><th>#</th><th>Name</th><th>Score</th></tr>"+
      data.map((x,i)=>`<tr><td>${i+1}</td><td>${x.name}</td><td>${x.score}/${x.total}</td></tr>`).join("")
      +"</table>";
  }

  loadBoard();
})();
</script>
</body>
</html>
